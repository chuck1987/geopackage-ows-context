== OWS Context SQL Extensions

[[owc_sql_resource_extension]]
=== SQL Resource Extension
Since relational databases have no mechanical way to control ordering, this extension provides an new datatype that contains an element that can be implemented as a column to support ordering.

==== Datatype owc:SQLResource
[[owcr1]]
[caption=""]
.Requirement 1
====
When the SQL Resource Extension is in use, an _owc:Resource_ SHALL be an _owc:SQLResource_.
====

This datatype extends _owc:Resource_ with the element(s) listed in <<sql_select_resource_extension_table>>.

[[sql_select_resource_extension_table]]
.Datatype owc:SQLSelectResource
[cols=",,,",options="header",]
|=======================================================================
|Name |Definition | Data Type and Values |Multiplicity and Use
|`order`|The ascending order of configured resources| DOUBLE| Zero or one (optional)
|=======================================================================

[[owc_sql_content_extension]]
=== SQL Content Extension
This extension is used when a Context document refers to content within a relational (SQL) database. 

[[owc_offering]]
==== Datatype owc:Offering
[[owcr2]]
[caption=""]
.Requirement 2
====
When the `code` of an _owc:Offering_ is `SQL`, _owc:Offering_ SHALL constrained as per <<sql_offering_table>>.
====

[NOTE]
====
The changes are [underline]#underlined#.
====

[[sql_offering_table]]
.Datatype owc:Offering for SQL Content Extension
[cols=",,,",options="header",]
|=======================================================================
|Name |Definition | Data Type and Values |Multiplicity and Use
|`code`|[underline]#`SQL`#| CharacterString| [underline]#One (mandated)# 
|`operation` |Operations used to invoke the service   | owc:Operation | [underline]#One (mandatory)#
|`content`  |N/A  |N/A   | [underline]#Zero (prohibited)#
|=======================================================================

[[owc_operation]]
==== Datatype owc:Operation
[[owcr3]]
[caption=""]
.Requirement 3
====
When the `code` of an _owc:Offering_ is `SELECT`, _owc:Operation_ child elements SHALL be constrained as per <<sql_operation_table>>.
====

[NOTE]
====
The changes are [underline]#underlined#.
====

[[sql_operation_table]]
.Datatype owc:Operation for SQL Content Extension
[cols=",,,",options="header",]
|=======================================================================
|Name |Definition | Data Type and Values |Multiplicity and Use
|`code`        |[underline]#`SELECT`#| CharacterString| [underline]#One (mandated)# 
|`method`      |[underline]#`SQL`#| CharacterString| [underline]#One (mandated)# 
|`type`        |[underline]#`SQL`#   | CharacterString | [underline]#One (mandated)#
|`requestURL`  |Service Request URL   | URI  | One (mandatory) 
|`request`     |Request body content   |[underline]#owc:SQLContent# (<<owc_sql_content>>)  | [underline]#One (mandatory)#
|`result`      |N/A   |N/A   | [underline]#Zero (prohibited)#
|`extension`   |Application specific content|N/A | Zero or more (optional)
|=======================================================================

[NOTE]
====
If the referenced content is within the database containing the Context, the `requestURL` should be `.`. Otherwise the `requestURL` should be a connect string.
====
 
[[owc_sql_content]]
==== Datatype owc:SQLContent
[[owcr4]]
[caption=""]
.Requirement 4
====
The Context Document SHALL use an _owc:SQLContent_ datatype as per <<sql_content_table>> as the `content` element in _owc:Content_ when the `code` of the parent _owc:Operation_ is `SELECT`.
====

[[sql_content_table]]
.Datatype owc:SQLContent
[cols=",,,",options="header",]
|=======================================================================
|Name |Definition | Data Type and Values |Multiplicity and Use
|`result`      |the result expression list, i.e., everything between SELECT and FROM|CharacterString | One (mandatory)
|`from`        |a single table or view name|CharacterString | One (mandatory)
|`where`       |the actual WHERE clause|CharacterString | Zero or one (optional)
|`order_by`    |the actual `ORDER BY` clause|CharacterString | Zero or one (optional)
|`group_by`    |the actual `GROUP BY` clause|CharacterString | Zero or one (optional)
|`extension`   |Application specific content|N/A | Zero or more (optional)
|=======================================================================

[NOTE]
====
If joins are needed, they should be established as views beforehand so that the `from` element can be a single value.
====
